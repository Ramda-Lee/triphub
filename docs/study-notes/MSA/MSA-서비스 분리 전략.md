# Microservices – 서비스 분리 전략 & 설계 기준

## 왜 "서비스 분리"가 중요할까?
> MSA의 본질은 "나눠서 독립적으로 운영하자"는 것  
→ 하지만 잘못 나누면 **더 큰 혼란**, **더 많은 장애**, **관리 지옥**

---

## 서비스 분리 기준

### 잘못된 분리 방식
| 방식 | 문제점 |
|------|--------|
| 기능 기반 분리 (ex. controller, service, repository) | 레이어 기준 분리라 실제 서비스 경계가 없음 |
| 기술 기반 분리 (ex. Spring팀, DB팀) | 실제 도메인/업무 흐름을 반영하지 못함 |
| 임의로 크기만 나눈 분리 | 분리했는데도 서로 자주 호출 → 더 복잡해짐 |

---

### 올바른 분리 기준 – **도메인 중심 분리**
> 도메인: 사용자, 결제, 예약, 알림 등 **비즈니스 기준으로 나누기**

| 기준 | 설명 |
|------|------|
| Bounded Context | 도메인의 경계를 명확히 구분함 |
| 책임 단일화 | 하나의 서비스가 하나의 책임만 가짐 (SRP) |
| 데이터 독립성 | 각 서비스는 자신의 DB만 소유 |
| 응집도 ↑, 결합도 ↓ | 내부 로직은 밀접하고, 외부 서비스와는 느슨하게 연결

---

## 서비스 분리 시 고려할 요소
| 요소 | 질문 |
|------|------|
| 변경 책임 | 이 기능이 자주 변경된다면, 따로 뺄 수 있는가? |
| 데이터 독립성 | 이 서비스는 자체 DB로 독립 가능할까? |
| 팀 구성 | 별도 팀이 관리할 만큼 독립적인 도메인인가? |
| 통신 최소화 | 서비스 간 호출이 너무 많지 않을까? |
| 장애 격리 | 이 서비스가 죽어도 나머지 서비스가 정상 동작 가능한가?

---

## 나누면 생기는 문제도 있음
- 데이터 중복: 서로 다른 서비스에 비슷한 정보가 생길 수 있음
- 통신 비용: REST/gRPC/Kafka 등 호출/이벤트 비용
- 트랜잭션 어려움: DB가 분리되기 때문에 SAGA 등 보완 필요

---

## 정리 요약
- MSA에서 **무엇을 어떻게 나누는지**가 가장 중요한 설계 포인트
- 도메인 기반 분리(DDD)가 가장 이상적인 기준
- 기능/기술 기반으로만 분리하면 실제 운영 시 장애/혼란 유발
- 서비스마다 **데이터, 책임, 변경 주기, 통신 빈도**를 기준으로 판단해야 함